# Changelog

## [1.0.4] - 2025-12-09 (16:32)

### Добавлено
- **Мобильная адаптация**: Полностью адаптивный дизайн для мобильных устройств
- Responsive header с адаптивными кнопками
- Адаптивные формы (1 колонка на мобильных, 2 на планшетах)
- Адаптивные KPI карточки (2 колонки на мобильных, 3-4 на десктопе)
- Адаптивные размеры шрифтов и отступов
- Оптимизированные иконки для мобильных

### Технические детали
- Использованы Tailwind breakpoints: `sm:` (640px+), `md:` (768px+), `lg:` (1024px+)
- Header: flex-col на мобильных, flex-row на десктопе
- Формы: grid-cols-1 на мобильных, grid-cols-2 на планшетах+
- KPI дневного отчета: 2x2 на мобильных, 4 в ряд на десктопе
- KPI месячного отчета: 2x3 на мобильных, 3x2 на планшетах
- Уменьшены padding и размеры шрифтов на мобильных

---

## [1.0.3] - 2025-12-09 (16:22)

### Исправлено
- **КРИТИЧЕСКОЕ: Проблема с часовым поясом**: Исправлена проблема, из-за которой дневной отчет показывал "нет данных" для всех периодов
- **Формат даты из PostgreSQL**: Backend теперь возвращает дату как текст (YYYY-MM-DD) вместо timestamp с часовым поясом
- **Приведение типов**: Добавлено приведение operator_id к числу для корректного сравнения

### Техническая причина проблемы
PostgreSQL хранит DATE как timestamp и при возвращении в JSON добавляет часовой пояс UTC:
- Дата в БД: `2025-12-09`
- Возвращалось: `2025-12-08T23:00:00.000Z` (UTC-1 = предыдущий день!)
- Искали: `2025-12-09`
- Результат: данные не находились

### Решение
- Изменен SQL запрос: `r.report_date::text` вместо `r.report_date`
- Теперь возвращается: `"2025-12-09"` (строка)
- Упрощен код сравнения дат в frontend

### Затронутые файлы
- `server/routes/reports.js` - исправлены SQL запросы для daily и monthly stats
- `client/src/components/Dashboard.js` - упрощен код, убрана ненужная нормализация дат

---

## [1.0.2] - 2025-12-09 (16:15)

### Исправлено
- **Обновление данных**: Теперь после добавления отчета данные автоматически обновляются в дневном и месячном отчетах
- **Месячный отчет**: Исправлена ошибка с NULL датами, которая приводила к "отвалу" месячного отчета
- **Формат даты**: Добавлена нормализация формата даты из PostgreSQL (ISO формат с временем преобразуется в YYYY-MM-DD)
- **Уведомление**: Добавлено уведомление "Отчет успешно сохранен!" после сохранения

### Технические детали
- Функция `addReport` теперь всегда вызывает `loadDailyStats()` и `loadMonthlyStats()` после сохранения
- Функция `getMonthlyStatsForOperator` теперь фильтрует NULL даты перед обработкой
- Функция `calculateTimeSlotData` нормализует формат даты перед сравнением
- Убраны отладочные console.log

---

## [1.0.1] - 2025-12-09 (15:59)

### Исправлено
- **Дневной отчет**: Теперь блок дневного отчета отображается всегда, даже если нет данных за выбранную дату. Показывается сообщение "Нет данных за выбранную дату" для каждого оператора.
- **Страница входа**: Убран текст с тестовыми учетными записями (supervisor/manager credentials) для повышения безопасности.

### Технические детали
- Изменен файл: `client/src/components/Dashboard.js`
  - Добавлена проверка на пустой массив операторов
  - Изменена логика отображения: вместо `return null` теперь показывается информативное сообщение
  
- Изменен файл: `client/src/components/Login.js`
  - Удален блок с тестовыми учетными записями

### Развертывание
- Frontend пересобран: `npm run build`
- Обновленная версия загружена на production сервер
- Изменения доступны по адресу: https://call.it-mydoc.ru

---

## [1.0.0] - 2025-12-09

### Добавлено
- Первый релиз системы отчетности колл-центра
- Управление операторами
- Ввод отчетов 3 раза в день
- Дневные и месячные отчеты
- Автоматический расчет KPI
- JWT аутентификация
- Разграничение прав доступа (Supervisor, Management, Admin)
- SSL сертификат
- Systemd автозапуск
